subroutine weno_z(f,fp,fm,Nx)
implicit none
integer :: Nx, i
real(8),dimension(-2:Nx+3) :: f, fp, fm
real(8) :: a1,a2,a3,b1,b2,b3,w1,w2,w3,e

e = 1.0e-12

do i = 0, Nx
	
	b1 = 13.0*(f(i-2)-2.0*f(i-1)+f(i))**2 + 3.0*(f(i-2)-4*f(i-1)+3.0*f(i))**2
	b2 = 13.0*(f(i-1)-2.0*f(i)+f(i+1))**2 + 3.0*(f(i-1)-f(i+1))**2
	b3 = 13.0*(f(i)-2.0*f(i+1)+f(i+2))**2 + 3.0*(3.0*f(i)-4.0*f(i+1)+f(i+2))**2
	
	a1 = 1.0*(1.0+abs(b3-b1)/(e+b1))
	a2 = 6.0*(1.0+abs(b3-b1)/(e+b2))
	a3 = 3.0*(1.0+abs(b3-b1)/(e+b3))
	
	w1 = a1/(a1+a2+a3)
	w2 = a2/(a1+a2+a3)
	w3 = a3/(a1+a2+a3)
	
	fm(i) = w1/3.0*f(i-2) - (7.0*w1+w2)/6.0*f(i-1) + (11.0*w1+5.0*w2+2.0*w3)/6.0*f(i) &
			+ (2.0*w2+5.0*w3)/6.0*f(i+1) - w3/6.0*f(i+2)
			
end do
	
do i = 0, Nx
	
	b3 = 13.0*(f(i-1)-2.0*f(i)  +f(i+1))**2 + 3.0*(f(i-1)-4.0*f(i)+3.0*f(i+1))**2
	b2 = 13.0*(f(i)  -2.0*f(i+1)+f(i+2))**2 + 3.0*(f(i)-f(i+2))**2
	b1 = 13.0*(f(i+1)-2.0*f(i+2)+f(i+3))**2 + 3.0*(3.0*f(i+1)-4.0*f(i+2)+f(i+3))**2
	
  a1 = 1.0 * ( 1.0 + abs(b1-b3)/(e+b1) )
  a2 = 6.0 * ( 1.0 + abs(b1-b3)/(e+b2) )
  a3 = 3.0 * ( 1.0 + abs(b1-b3)/(e+b3) )	
	
  w1 = a1 / ( a1+a2+a3)
  w2 = a2 / ( a1+a2+a3)
  w3 = a3 / ( a1+a2+a3)
 	
 	fp(i) = w3*(-f(i-1)+5.0*f(i)+2.0*f(i+1))/6.0 &
 				 +w2*(2.0*f(i)+5.0*f(i+1)-f(i+2))/6.0 &
 				 +w1*(11.0*f(i+1)-7.0*f(i+2)+2.0*f(i+3))/6.0	
	
	
end do

end subroutine

subroutine weno_js(f,fp,fm,Nx)
implicit none
integer :: Nx, i
real(8),dimension(-2:Nx+3) :: f, fp, fm
real(8) :: a1,a2,a3,b1,b2,b3,w1,w2,w3,e

e = 1.0e-12

do i = 0, Nx
	
	b1 = 13.0*(f(i-2)-2.0*f(i-1)+f(i))**2 + 3.0*(f(i-2)-4*f(i-1)+3.0*f(i))**2
	b2 = 13.0*(f(i-1)-2.0*f(i)+f(i+1))**2 + 3.0*(f(i-1)-f(i+1))**2
	b3 = 13.0*(f(i)-2.0*f(i+1)+f(i+2))**2 + 3.0*(3.0*f(i)-4.0*f(i+1)+f(i+2))**2
	
	a1 = 1.0/(e+b1)**2
	a2 = 6.0/(e+b2)**2
	a3 = 3.0/(e+b3)**2
	
	w1 = a1/(a1+a2+a3)
	w2 = a2/(a1+a2+a3)
	w3 = a3/(a1+a2+a3)
	
	fm(i) = w1/3.0*f(i-2) - (7.0*w1+w2)/6.0*f(i-1) + (11.0*w1+5.0*w2+2.0*w3)/6.0*f(i) &
			+ (2.0*w2+5.0*w3)/6.0*f(i+1) - w3/6.0*f(i+2)
			
end do
	
do i = 0, Nx
	
	b3 = 13.0*(f(i-1)-2.0*f(i)  +f(i+1))**2 + 3.0*(f(i-1)-4.0*f(i)+3.0*f(i+1))**2
	b2 = 13.0*(f(i)  -2.0*f(i+1)+f(i+2))**2 + 3.0*(f(i)-f(i+2))**2
	b1 = 13.0*(f(i+1)-2.0*f(i+2)+f(i+3))**2 + 3.0*(3.0*f(i+1)-4.0*f(i+2)+f(i+3))**2
	
  a1 = 1.0/(e+b1)**2
  a2 = 6.0/(e+b2)**2
  a3 = 3.0/(e+b3)**2	
	
  w1 = a1 / (a1+a2+a3)
  w2 = a2 / (a1+a2+a3)
  w3 = a3 / (a1+a2+a3)
 	
 	fp(i) = w3*(-f(i-1)+5.0*f(i)+2.0*f(i+1))/6.0 &
 				 +w2*(2.0*f(i)+5.0*f(i+1)-f(i+2))/6.0 &
 				 +w1*(11.0*f(i+1)-7.0*f(i+2)+2.0*f(i+3))/6.0	
	
	
end do

end subroutine

subroutine weno_m(f,fp,fm,Nx)
implicit none
integer :: Nx, i
real(8),dimension(-2:Nx+3) :: f, fp, fm
real(8) :: a1,a2,a3,b1,b2,b3,w1,w2,w3,e

e = 1.0e-12

do i = 0, Nx
	
	b1 = (13.0*(f(i-2)-2.0*f(i-1)+f(i))**2 + 3.0*(f(i-2)-4*f(i-1)+3.0*f(i))**2)/12.0
	b2 = (13.0*(f(i-1)-2.0*f(i)+f(i+1))**2 + 3.0*(f(i-1)-f(i+1))**2)/12.0
	b3 = (13.0*(f(i)-2.0*f(i+1)+f(i+2))**2 + 3.0*(3.0*f(i)-4.0*f(i+1)+f(i+2))**2)/12.0
	
	a1 = 0.1/(e+b1)**2
	a2 = 0.6/(e+b2)**2
	a3 = 0.3/(e+b3)**2
	
	w1 = a1/(a1+a2+a3)
	w2 = a2/(a1+a2+a3)
	w3 = a3/(a1+a2+a3)
	
	w1 = g(w1,1)
	w2 = g(w2,2)
	w3 = g(w3,3)
	
	fm(i) = w1/3.0*f(i-2) - (7.0*w1+w2)/6.0*f(i-1) + (11.0*w1+5.0*w2+2.0*w3)/6.0*f(i) &
			+ (2.0*w2+5.0*w3)/6.0*f(i+1) - w3/6.0*f(i+2)
			
end do
	
do i = 0, Nx
	
	b3 = (13.0*(f(i-1)-2.0*f(i)  +f(i+1))**2 + 3.0*(f(i-1)-4.0*f(i)+3.0*f(i+1))**2)/12.0
	b2 = (13.0*(f(i)  -2.0*f(i+1)+f(i+2))**2 + 3.0*(f(i)-f(i+2))**2)/12.0
	b1 = (13.0*(f(i+1)-2.0*f(i+2)+f(i+3))**2 + 3.0*(3.0*f(i+1)-4.0*f(i+2)+f(i+3))**2)/12.0
	
  a1 = 0.1/(e+b1)**2
  a2 = 0.6/(e+b2)**2
  a3 = 0.3/(e+b3)**2
		
  w1 = a1 / (a1+a2+a3)
  w2 = a2 / (a1+a2+a3)
  w3 = a3 / (a1+a2+a3)
  
	a1 = g(w1,1)
	a2 = g(w2,2)
	a3 = g(w3,3)
 
  w1 = a1 / (a1+a2+a3)
  w2 = a2 / (a1+a2+a3)
  w3 = a3 / (a1+a2+a3)	
  
 	fp(i) = w3*(-f(i-1)+5.0*f(i)+2.0*f(i+1))/6.0 &
 				 +w2*(2.0*f(i)+5.0*f(i+1)-f(i+2))/6.0 &
 				 +w1*(11.0*f(i+1)-7.0*f(i+2)+2.0*f(i+3))/6.0	
	
	
end do

end subroutine

function g(a,k)
implicit none
real(8) ::g,a,w
integer :: k

 if( k==1 ) then
 	 w = 1.0/10.0
 else if( k==2 )then
 	 w = 6.0/10.0
 else
 	 w = 3.0/10.0
 end if
 
 	 g = a*(w+w**2-3.0*w*a+a**2)/(w**2+a*(1.0-2.0*w))

end function

